# spec-code-ai-reviewer → spec-code-ai-mapper への変更

`spec-code-ai-reviewer/versions/v0.8.0`（ベース）から `versions/v0.8.0`（修正版）への初回コミット時点での変更点。

## 1. リブランディング（reviewer → mapper）

プロジェクト名を `spec-code-ai-reviewer` から `spec-code-ai-mapper` に変更。全体に渡る名称変更。

| 対象 | 変更内容 |
|------|----------|
| backend/pyproject.toml | パッケージ名・説明文を `spec-code-ai-mapper-backend` に変更 |
| backend/app/main.py | FastAPI タイトル・説明文・バージョン取得先を変更 |
| backend/app/routers/review.py | バージョン取得先を変更 |
| spec.md | タイトル・目的・課題の説明を「AIレビュアー」から「AIマッパー/紐付け管理」に変更 |
| config-file-generator-spec.md | 参照先名を変更 |
| frontend reviewer/index.tsx | APP_INFO の name/description を変更 |

## 2. プリセット機能の削除

`spec-code-ai-reviewer` にあったプロンプトプリセットカタログ機能を全面削除し、シンプルなデフォルト値に置き換え。

### 削除されたファイル（reviewer側のみ）

| ファイル | 説明 |
|------|------|
| core/data/presetCatalog.ts | プリセットカタログデータ |
| core/hooks/usePresetCatalog.ts | プリセットカタログフック |
| core/components/shared/SettingsModal/PromptPresetsSection.tsx | プリセット一覧UIコンポーネント |
| features/presets/index.tsx | プリセットページ |
| pages/PresetsPage.tsx | プリセットページラッパー |

### 変更されたファイル

| ファイル | 変更内容 |
|------|----------|
| core/hooks/useSettings.ts | `PRESET_CATALOG` 参照を削除し、`DEFAULT_SPEC_TYPES`/`DEFAULT_SYSTEM_PROMPTS` をインラインで定義 |
| core/index.ts | `PromptPresetsSection`, `usePresetCatalog` のエクスポートを削除 |
| SettingsModal/SettingsModal.tsx | `promptPresets` セクションとプロパティを削除 |
| SystemPromptEditor.tsx | プリセット選択ドロップダウンを削除（`presets`, `selectedPreset`, `onPresetChange` props 削除） |
| useReviewerSettings.ts | `selectPreset`, `applyPreset`, `systemPromptPresets`, `selectedPreset` を削除。カタログ統合ロジックを簡素化 |

## 3. Mapper 機能の追加（新規）

| ファイル | 説明 |
|------|----------|
| features/mapper/Mapper.tsx (198行) | AI Mapper 画面のメインコンポーネント（新規） |
| pages/MapperPage.tsx (5行) | Mapper ページラッパー（新規） |
| App.tsx | `/presets` ルートを削除、`/mapper` ルートを追加 |
| reviewer/index.tsx | ヘッダーのリンクを「プリセット」→「AI Mapper」に変更（アイコンも `BookOpen` → `Layers`） |

## 4. SharedStateContext の導入（新規）

Reviewer と Mapper 間で状態を共有するための React Context を新設。

| ファイル | 説明 |
|------|----------|
| core/contexts/SharedStateContext.tsx (93行) | 共有ステート Context（新規） |
| main.tsx | `SharedStateProvider` で `App` をラップ |

共有されるステート: `specFiles`, `specMarkdown`, `codeFiles`, `codeWithLineNumbers`, `llmConfig`, `currentPromptValues`, `splitSettings`, `splitPreviewResult`

| 変更されたフック | 変更内容 |
|------|----------|
| useFileConversion.ts | ローカル state を `useSharedState()` から取得するように変更 |
| useSplitSettings.ts | 同上 |
| useReviewerSettings.ts | `llmConfig`, `currentPromptValues` を共有ステートから取得 |

## 5. マッピングポリシー機能の追加

構造マッチング時のマッピング方式（standard / strict / detailed）を選択可能に。

| ファイル | 変更内容 |
|------|----------|
| reviewer/types/index.ts | `SplitSettings` に `mappingPolicy` フィールド追加、`StructureMatchingRequest` にも追加 |
| useSplitSettings.ts | デフォルト設定に `mappingPolicy: 'standard'` 追加 |
| SplitSettingsSection.tsx | マッピング方式のラジオボタンUI追加（標準/厳密/詳細） |
| reviewer/index.tsx | `executeStructureMatching` 呼び出し時に `mappingPolicy` を渡すように追加 |
| backend/app/models/schemas.py | `StructureMatchingRequest` に `mappingPolicy` フィールド追加 |
| backend/app/routers/review.py | `mappingPolicy` に応じてプロンプトの `purpose` を切り替えるロジック追加（strict/detailed/standard） |

## 6. バージョン情報の簡素化

| ファイル | 変更内容 |
|------|----------|
| core/hooks/useVersions.ts | バージョンリストを `v0.8.0` のみに変更（v0.6.0, v0.7.0, v0.8.1 を削除） |

# 仕様の確認と修正必要な点

## 1. レビュー実行フローの削除とマッピング実行のメイン画面統合 -- 対応済み (2026-02-14)

### 対応内容

以下を実施し、メイン画面でマッピング実行・結果表示が完結するように変更した。

- 旧レビュー実行フロー（レビュー実行ボタン、実行中画面、結果表示画面、画面切替）を `reviewer/index.tsx` から全面削除
- `Mapper.tsx` のマッピング実行ロジック（`handleMapping`）とTraceability Matrix表示、Markdownエクスポート機能をメイン画面に統合
- 不要になったファイルを削除: `features/mapper/Mapper.tsx`, `features/mapper/index.ts`, `pages/MapperPage.tsx`, `hooks/useReviewExecution.ts`, `components/ExecutingScreen.tsx`, `components/SplitExecutingScreen.tsx`, `components/ReviewResult.tsx`, `core/contexts/SharedStateContext.tsx`
- `App.tsx` から `/mapper` ルートを削除、`main.tsx` から `SharedStateProvider` を削除
- 3つのフック（`useFileConversion`, `useSplitSettings`, `useReviewerSettings`）を `useSharedState()` からローカル `useState` に戻した
- `api.ts` から不要なAPI関数（`executeReview`, `executeGroupReview`, `executeIntegrate`）を削除
- `types/index.ts` から不要な型定義（`ReviewResult`, `ReviewMeta`, `ReviewExecutionData`, `ReviewerState`, `ReviewRequest`, `GroupReview*`, `Integrate*`, `SplitReviewState` 等）を削除
- `useZipExport` から不要な `downloadZip`/`downloadReport`/`copyReport` を削除（`downloadSpecMarkdown`/`downloadCodeWithLineNumbers` のみ残存）
- 関連テストファイルを修正

### 現状の問題（対応前）

メイン画面（Reviewer）にAIレビュアー時代の「レビュー実行」ボタン、実行中画面、結果表示画面が残っている。
Mapper ページ（`/mapper`）は別ページとして存在するが、メイン画面からそのままマッピングを実行し、結果を表示できるべき。

### 対応方針

メイン画面のレビュー実行フローを削除し、マッピング実行・結果表示をメイン画面に統合する。

Mapper を別ページではなくメイン画面に統合することで、Reviewer と Mapper 間で状態を共有するために導入した `SharedStateContext` は不要になる。
各 state はメインコンポーネント（または統合後のカスタムフック）内でローカルに管理すればよい。

### 対象ファイル

| ファイル | 現状 | 変更内容 |
|------|------|----------|
| features/reviewer/index.tsx | レビュー実行ボタン（L700-723）、`handleReviewExecute`（L483-510）、`executeSplitReviewFlow`（L245-476）、画面切替（main/executing/result）を含む | レビュー実行フローを削除し、マッピング実行・結果表示に置き換え |
| features/reviewer/hooks/useReviewExecution.ts | 一括レビュー実行ロジック（2回実行）、結果管理 | 不要。マッピング実行ロジックに置き換え |
| features/reviewer/components/ExecutingScreen.tsx | 一括レビュー用の実行中画面（スピナー表示） | 不要、または マッピング実行中表示に置き換え |
| features/reviewer/components/SplitExecutingScreen.tsx | 分割レビュー用の実行中画面（フェーズ進捗表示） | 不要、または マッピング実行中表示に置き換え |
| features/reviewer/components/ReviewResult.tsx | レビュー結果表示（OK/Warning/NG判定、レポート、ZIP出力） | 不要。マッピング結果（トレーサビリティ・マトリクス）表示に置き換え |
| core/hooks/useScreenManager.ts | `main` / `executing` / `result` の画面遷移管理 | マッピングフローに合わせてスクリーン定義を見直し |
| features/mapper/Mapper.tsx | 別ページとしてマッピング結果表示（マトリクス表、Markdownエクスポート） | メイン画面に統合。`/mapper` ルートは廃止 |
| pages/MapperPage.tsx | Mapper ページラッパー | 不要（メイン画面に統合） |
| App.tsx | `/mapper` ルート定義 | `/mapper` ルートを削除 |
| core/contexts/SharedStateContext.tsx | Reviewer と Mapper 間で `specFiles`, `specMarkdown`, `codeFiles`, `codeWithLineNumbers`, `llmConfig`, `currentPromptValues`, `splitSettings`, `splitPreviewResult` を共有する React Context | 不要（メイン画面統合により、ページ間の状態共有が不要になる）。削除し、各 state をローカル管理に戻す |
| main.tsx | `SharedStateProvider` で `App` をラップ | `SharedStateProvider` のラップを削除 |
| features/reviewer/hooks/useFileConversion.ts | `useSharedState()` から `specFiles`, `specMarkdown`, `codeFiles`, `codeWithLineNumbers` を取得 | ローカル state に戻す（元の `useState` に戻す） |
| features/reviewer/hooks/useSplitSettings.ts | `useSharedState()` から `splitSettings`, `splitPreviewResult` を取得 | ローカル state に戻す |
| features/reviewer/hooks/useReviewerSettings.ts | `useSharedState()` から `llmConfig`, `currentPromptValues` を取得 | ローカル state に戻す |

## 2. マッピングポリシーに応じたシステムプロンプトのフロントエンド切替 -- 対応済み (2026-02-14)

### 対応内容

以下を実施し、ポリシー変更がフロントエンドのSystemPromptEditorに即座に反映されるようにした。

- `useReviewerSettings.ts` にポリシー別プロンプトテンプレート定数 `MAPPING_POLICY_PURPOSES`（standard/strict/detailed）を追加
- `applyMappingPolicy` コールバックを追加し、ポリシー変更時に `purpose` フィールドを自動更新
- `SplitSettingsSection.tsx` に `onMappingPolicyChange` propを追加し、ポリシーラジオボタン変更時にコールバックを呼び出し
- バックエンド `review.py` から `mappingPolicy` ベースの `purpose` 上書きロジックを削除し、フロントエンドから送られた `systemPrompt.purpose` をそのまま使用するように簡素化

### 現状の問題（対応前）

マッピングポリシー（standard / strict / detailed）ごとのシステムプロンプト切替がバックエンド（`review.py`）にハードコードされている。
ユーザーがUI上でシステムプロンプトを確認・編集できず、ポリシー選択がプロンプトにどう影響するか見えない。

### 対応方針

ポリシー選択に応じて、フロントエンド側でシステムプロンプト（特に `purpose` フィールド）を切り替える。
ユーザーは SystemPromptEditor で内容を確認・微調整できるようにする。
バックエンドのハードコードされたポリシー別プロンプト生成ロジックは、フロントエンドから送られた `systemPrompt` をそのまま使うように簡素化する。

### 対象ファイル

| ファイル | 現状 | 変更内容 |
|------|------|----------|
| features/reviewer/components/SplitSettingsSection.tsx | マッピングポリシーのラジオボタンUI（L165-207）。ポリシー値を保存するのみで、プロンプトへの反映なし | ポリシー変更時に `currentPromptValues` を切り替えるコールバックを追加 |
| features/reviewer/hooks/useReviewerSettings.ts | `currentPromptValues` を管理、`updatePromptValue()` で個別フィールド更新 | ポリシー別のデフォルトプロンプトテンプレートを定義し、ポリシー変更時に `purpose` を切り替えるロジックを追加 |
| core/components/shared/SystemPromptEditor.tsx | 現在の `currentValues` を表示・編集するUI | 変更不要（ポリシー切替でプロンプト値が変わればそのまま反映される） |
| backend/app/routers/review.py | `mappingPolicy` に基づいて `purpose` をバックエンドで上書き（L198-231） | フロントエンドから送られた `systemPrompt` をそのまま使うように簡素化 |

## 3. 分割設定UIの簡素化（一括/分割選択の廃止） -- 対応済み (2026-02-14)

### 対応内容

以下を実施し、常に分割モードで動作するようにUIとロジックを簡素化した。

- `types/index.ts` から `SplitMode` 型を削除、`SplitSettings` から `documentMode`/`codeMode` フィールドを削除（`{ documentMaxDepth, mappingPolicy }` のみに簡素化）
- `useSplitSettings.ts` から `isSplitEnabled`, `reviewMode`, `estimatedReviewCount` の算出ロジックを削除。`executePreview` 内の `documentMode === 'split'` / `codeMode === 'split'` 条件分岐を削除（常に分割実行）
- `SplitSettingsSection.tsx` から設計書モード・プログラムモードの一括/分割ラジオボタンを全面削除。分割オプション（見出し深さ、コード言語情報）を常時表示に変更
- `reviewer/index.tsx` から `isSplitEnabled` に基づく分岐処理を削除（常に分割フローを実行）

### 現状の問題（対応前）

分割設定セクションに「設計書モード: 一括 / 分割」「プログラムモード: 一括 / 分割」を選ぶラジオボタンが残っている。
AIマッパーでは設計書・コード両方の分割が必須であり、一括モードの選択は不要。

### 対応方針

一括/分割の選択UIを削除し、常に「分割」モードで動作するようにする。
分割の深さ（設計書のH2/H3/H4）の選択は残す。

### 対象ファイル

| ファイル | 現状 | 変更内容 |
|------|------|----------|
| features/reviewer/components/SplitSettingsSection.tsx | 設計書モード（一括/分割）のラジオボタン（L98-128）、プログラムモード（一括/分割）のラジオボタン（L132-163） | 一括/分割の選択UIを削除。常に分割モードであることを前提としたUIに変更 |
| features/reviewer/hooks/useSplitSettings.ts | `settings.documentMode`/`settings.codeMode` が `'batch' | 'split'` で管理。`isSplitEnabled` は「いずれかが split なら true」で判定（L144） | `documentMode`/`codeMode` を常に `'split'` に固定。`isSplitEnabled` は常に `true` |
| features/reviewer/types/index.ts | `SplitMode = 'batch' | 'split'`（L160）、`SplitSettings` に `documentMode`/`codeMode` | `SplitMode` 型と `documentMode`/`codeMode` フィールドを廃止、または常に `'split'` 固定 |
| core/contexts/SharedStateContext.tsx | `splitSettings` の初期値に `documentMode: 'batch'`, `codeMode: 'batch'` | 初期値を `documentMode: 'split'`, `codeMode: 'split'` に変更（型を残す場合） |
| features/reviewer/index.tsx | `isSplitEnabled` で分割/一括の分岐処理（L489、L703、L715、L750） | 常に分割モードで動作するように分岐を削除・簡素化 |

## 4. バージョン番号の変更（v0.8.0 → v0.1.0）

### 現状の問題

バージョン番号がAIレビュアー（spec-code-ai-reviewer）から引き継いだ `v0.8.0` のままになっている。
AIマッパーは別プロダクトであるため、`v0.1.0` から開始すべき。

### 対応方針

全ファイルのバージョン番号を `0.8.0` → `0.1.0` に変更する。
ディレクトリ名（`versions/v0.8.0/`）のリネームも必要。

### 対象ファイル

| ファイル | 現状 | 変更内容 |
|------|------|----------|
| spec.md | `バージョン: 0.8.0`、レスポンス例・テストケース等に `v0.8.0` が多数 | `0.1.0` / `v0.1.0` に変更 |
| config-file-generator-spec.md | `バージョン: 0.8.0`、スキーマ定義の `version: 'v0.8.0'` 等 | `0.1.0` / `v0.1.0` に変更 |
| frontend/package.json | `"version": "0.8.0"` | `"version": "0.1.0"` に変更 |
| backend/pyproject.toml | `version = "0.8.0"` | `version = "0.1.0"` に変更 |
| frontend/src/features/reviewer/index.tsx | `APP_INFO.version: 'v0.8.0'` | `'v0.1.0'` に変更 |
| frontend/src/core/hooks/useVersions.ts | `{ value: 'v0.8.0', label: 'v0.8.0', isLatest: true }` | `v0.1.0` に変更 |
| frontend/src/features/config-file-generator/schema/configSchema.ts | `version: 'v0.8.0'`（2箇所） | `'v0.1.0'` に変更 |
| ディレクトリ | `versions/v0.8.0/` | `versions/v0.1.0/` にリネーム |

## 6. マッピング実行中画面・結果画面の追加 -- 対応済み (2026-02-14)

### 対応内容

以下を実施し、メイン画面 → 実行中画面 → 結果画面の画面切替フローを追加した。

- `MappingExecutingScreen.tsx` を新規作成（スピナー表示、エラー時リトライボタン、「← 戻る」ボタン）
- `MappingResult.tsx` を新規作成（4セクション構成: Traceability Matrix / 実行情報 / 詳細レポート(コピー・ダウンロード) / ZIP一式ダウンロード）
- `types/index.ts` に `MappingExecutionMeta` 型を追加
- `useZipExport.ts` に `downloadMappingZip` 関数を追加（JSZip使用、6ファイル同梱: README.md, system-prompt.md, spec-markdown.md, code-numbered.txt, traceability-matrix.md, mapping-report.md）
- `reviewer/index.tsx` に `useScreenManager` + `ScreenContainer` を導入し、`main` → `executing` → `result` の画面切替を統合
- メイン画面にインライン表示していた Traceability Matrix テーブルと Markdown出力ボタンを削除（結果画面に移動）
- `<Header>` コンポーネントをメイン画面のみに配置（実行中・結果画面では非表示）
- 実行中・結果画面の横幅を `Layout` の `max-w-4xl` に統一

### 背景

項目1の対応でレビュー実行フロー（実行中画面、結果画面、画面切替）が削除され、マッピング実行・結果表示がメイン画面にインライン表示されている。
現状は「マッピング実行」ボタン押下 → ボタン上でスピナー表示 → 結果をメイン画面下部にTraceability Matrixテーブルとして表示、という簡素な実装になっている。

旧レビュアーの実行フロー（`ExecutingScreen` / `SplitExecutingScreen` / `ReviewResult`）と同様に、マッピング専用の実行中画面と結果画面を画面切替で表示する方式に変更する。

### 参考元（spec-code-ai-reviewer v0.8.0）

| コンポーネント | 概要 |
|------|------|
| `ExecutingScreen.tsx` | シンプルなスピナー + 実行回数表示 |
| `SplitExecutingScreen.tsx` | 3フェーズ（構造マッチング → グループレビュー → 結果統合）の進捗をStepCardで表示。各ステップの展開/折りたたみ、エラー時のリトライ/スキップ |
| `ReviewResult.tsx` | 簡易判定 → 実行情報（`ExecutionInfo`）→ 詳細レポート（コピー/ダウンロード）→ ZIP一式ダウンロード の4セクション構成 |
| `ExecutionInfo.tsx` | バージョン、モデルID、実行日時、トークン数、設計書/プログラムファイル一覧を表示する汎用コンポーネント |

### 対応方針

#### 6-1. 画面切替の導入

既存の `useScreenManager` フック（`core/hooks/useScreenManager.ts`）と `ScreenState` 型（`'main' | 'executing' | 'result'`）を活用し、メインコンポーネント（`reviewer/index.tsx`）に画面切替を導入する。

- `main`: 現在のメイン画面（ファイル選択、変換、分割、マッピング実行ボタンまで）
- `executing`: マッピング実行中画面
- `result`: マッピング結果画面

#### 6-2. マッピング実行中画面の作成

**新規ファイル**: `features/reviewer/components/MappingExecutingScreen.tsx`

旧レビュアーの `SplitExecutingScreen` を参考に、マッピング実行の進捗を表示するコンポーネントを作成する。
ただし、現在のマッピングは構造マッチングの1ステップのみ（グループレビュー・結果統合は不要）であるため、`ExecutingScreen` に近いシンプルな構成にする。

**表示内容:**
- ヘッダー（「マッピング実行中」+ 「← 戻る」ボタン）
- スピナーアニメーション + 実行中メッセージ
- タイムアウト注意書き
- エラー発生時のエラーメッセージ表示 + リトライボタン

**Props:**
```typescript
interface MappingExecutingScreenProps {
  isExecuting: boolean
  error: string | null
  onBack: () => void
  onRetry: () => void
}
```

#### 6-3. マッピング結果画面の作成

**新規ファイル**: `features/reviewer/components/MappingResult.tsx`

旧レビュアーの `ReviewResult`（分割レビュー結果表示部分: L148-256）の構成を参考に、以下の4セクション構成で作成する。
各セクションは旧レビュアーと同様に `bg-white rounded-lg shadow-md p-6 mb-6` のカードスタイルで統一する。

**セクション1: Traceability Matrix**
- セクションヘッダー: `<Layers />` アイコン + 「Traceability Matrix」
- 現在のメイン画面にあるTraceability Matrixテーブル（`reviewer/index.tsx` L488-530）をそのまま移植
- テーブルカラム: ID / Specification Section / Associated Code / Reason
- カバレッジサマリ（グループ数、設計書セクション数、コードシンボル数）をテーブル上部に表示

**セクション2: 実行情報**
- セクションヘッダー: 「実行情報」
- 既存の `ExecutionInfo` コンポーネントを再利用
- バージョン、モデルID、実行日時、トークン数（入力/出力）
- 設計書ファイル、プログラムファイルの一覧

**セクション3: 詳細レポート**
- セクションヘッダー: `<FileText />` アイコン + 「詳細レポート」（旧レビュアーと同様）
- AIの出力（構造マッチングのレスポンス全文）を `<pre>` タグで表示（`bg-gray-50 rounded-lg p-4 font-mono text-sm overflow-auto max-h-96`）
- アクションボタン（旧レビュアーと同様のレイアウト）:
  - コピーボタン（`<Clipboard />` アイコン、グレー系）
  - ダウンロードボタン（`<Save />` アイコン、ブルー系、`.md` ファイルとしてダウンロード）
- これにより現在のCSVダウンロード機能は不要になる

**セクション4: 一式ダウンロード（ZIP）**
- 旧レビュアーのZIPダウンロードセクションと同様の構成
- `useZipExport` フックにZIPダウンロード機能を追加（`downloadMappingZip`）
- ZIPに含めるファイル一覧:

| ファイル名 | 内容 |
|------|------|
| README.md | マッピング情報と同梱ファイルの説明 |
| system-prompt.md | システムプロンプト（役割・目的・出力形式・注意事項） |
| spec-markdown.md | 変換後の設計書（マークダウン形式） |
| code-numbered.txt | 行番号付きプログラム |
| traceability-matrix.md | マッピング結果（Traceability Matrix） |
| mapping-report.md | AIの出力レポート全文 |

**Props:**
```typescript
interface MappingResultProps {
  mappingResult: MatchedGroup[]
  executionMeta: MappingExecutionMeta  // 新規型（後述）
  reportText: string                   // AIの出力全文
  onCopyReport: (text: string) => void
  onDownloadReport: (text: string) => void
  onDownloadZip: () => void
  onBack: () => void
}
```

#### 6-4. 型定義の追加

**変更ファイル**: `features/reviewer/types/index.ts`

```typescript
// マッピング実行のメタ情報
export interface MappingExecutionMeta {
  version: string
  modelId: string
  executedAt: string
  inputTokens?: number
  outputTokens?: number
  designs: { filename: string; role?: string; type?: string; tool?: string }[]
  programs: { filename: string }[]
  mappingPolicy: string
  totalGroups: number
}
```

#### 6-5. useZipExport の拡張

**変更ファイル**: `features/reviewer/hooks/useZipExport.ts`

- `downloadMappingZip` 関数を追加
- JSZip ライブラリを使用（要: `npm install jszip`）
- ZIP内に README.md、system-prompt.md、spec-markdown.md、code-numbered.txt、traceability-matrix.md、mapping-report.md を同梱

#### 6-6. メインコンポーネントの画面切替統合

**変更ファイル**: `features/reviewer/index.tsx`

- `useScreenManager` フックを導入
- `handleMapping` の実行開始時に `showExecuting()` で画面遷移
- 実行完了時に `showResult()` で結果画面に遷移
- エラー時は実行中画面でエラー表示（リトライ可能）
- 結果画面の「← 戻る」ボタンで `showMain()` を呼び出し
- 現在メイン画面にインライン表示している Traceability Matrix テーブルと Markdown出力ボタンを削除（結果画面に移動）
- `mappingResult` に加え、`mappingReportText`（AIの出力全文）と `mappingMeta`（実行メタ情報）をstateに追加

#### 6-7. コンポーネントのエクスポート

**変更ファイル**: `features/reviewer/components/index.ts`

- `MappingExecutingScreen` と `MappingResult` をエクスポートに追加

### 対象ファイル一覧

| ファイル | 変更種別 | 変更内容 |
|------|------|----------|
| features/reviewer/components/MappingExecutingScreen.tsx | **新規** | マッピング実行中画面コンポーネント |
| features/reviewer/components/MappingResult.tsx | **新規** | マッピング結果画面コンポーネント（サマリ・実行情報・Traceability Matrix・詳細レポート・ZIP） |
| features/reviewer/components/index.ts | 変更 | 新規コンポーネントのエクスポート追加 |
| features/reviewer/types/index.ts | 変更 | `MappingExecutionMeta` 型追加 |
| features/reviewer/hooks/useZipExport.ts | 変更 | `downloadMappingZip` 関数追加（JSZip使用） |
| features/reviewer/index.tsx | 変更 | `useScreenManager` 導入、画面切替ロジック、インラインのマッピング結果表示を削除 |
| core/components/shared/ExecutionInfo.tsx | **新規** | 旧レビュアーの `ExecutionInfo` をcoreに移植（マッピング結果画面から使用） |
| package.json | 変更 | `jszip` 依存追加 |

## 7. マッピング方式プリセットカタログの導入とシステムプロンプト管理の一元化 -- 対応済み (2026-02-14)

### 対応内容

以下を実施し、マッピング方式ごとのシステムプロンプト（役割・目的・出力形式・注意事項の4項目すべて）をフロントエンド側で一元管理するように変更した。

- `core/data/mappingPresetCatalog.ts` を新規作成し、3方式（standard/strict/detailed）のプリセットを `MappingPreset` 型で定義
  - 各プリセットは `systemPrompt: { role, purpose, format, notes }` の4項目を持つ
  - `format` にはバックエンドでハードコードされていたJSON出力形式仕様を移植
  - `notes` にはバックエンドでハードコードされていた6つの注意事項を移植。strict/detailed は方式固有の注意事項を追加
- `MappingPolicySection.tsx` を新規作成し、マッピング方式選択UIを独立セクションとして分離
- `SplitSettingsSection.tsx` からマッピング方式ラジオボタンUI・`onMappingPolicyChange` prop・`handleMappingPolicyChange` コールバックを削除
- `useReviewerSettings.ts` の `MAPPING_POLICY_PURPOSES` 定数を削除し、`applyMappingPolicy` をカタログから4項目すべてを更新するように変更。初期値もカタログの standard プリセットから取得
- `reviewer/index.tsx` のUI配置順を変更: コードファイル → **マッピング方式** → システムプロンプト設定 → トークン見積 → 分割設定 → 実行ボタン
- バックエンド `review.py` の `structure_matching` エンドポイントで、`purpose` のラッピング（「最終的な目的:」「この目的を達成するため...」）を削除し、4項目すべてをフロントエンドから送られた値をそのまま使用するように変更（未指定時はフォールバック）

### 現状の問題（対応前）

- マッピングポリシー変更時に `purpose` フィールドのみ更新され、`role` / `format` / `notes` は変更されなかった
- バックエンドの `structure_matching` エンドポイントで `output_format`（JSON出力形式）と `notes`（注意事項）がハードコードされており、フロントエンドのSystemPromptEditorに反映されず、ユーザーが確認・編集できなかった
- マッピング方式の選択が分割設定セクション内に埋もれていた

### 対応方針

- マッピング方式ごとのプリセットカタログを新設し、システムプロンプトの4項目すべてを定義
- ポリシー変更時に4項目すべてを更新し、SystemPromptEditor に即座に反映
- マッピング方式選択を独立セクションとしてシステムプロンプト設定の直前に配置
- バックエンドは4項目すべてをフロントエンドからパススルーで受け取り、ハードコード値はフォールバックとしてのみ使用

### 対象ファイル一覧

| ファイル | 変更種別 | 変更内容 |
|------|------|----------|
| core/data/mappingPresetCatalog.ts | **新規** | 3方式のプリセットカタログ定義（`MappingPreset` 型、`MAPPING_PRESET_CATALOG`） |
| features/reviewer/components/MappingPolicySection.tsx | **新規** | マッピング方式選択UIコンポーネント（独立セクション） |
| features/reviewer/components/index.ts | 変更 | `MappingPolicySection` のエクスポート追加 |
| features/reviewer/hooks/useReviewerSettings.ts | 変更 | `MAPPING_POLICY_PURPOSES` 削除、カタログ使用、`applyMappingPolicy` で4項目全更新、初期値変更 |
| features/reviewer/components/SplitSettingsSection.tsx | 変更 | マッピング方式UI・`onMappingPolicyChange` prop・`handleMappingPolicyChange` 削除 |
| features/reviewer/index.tsx | 変更 | `MappingPolicySection` 追加、UI配置順変更、`handleMappingPolicyChange` コールバック追加 |
| backend/app/routers/review.py | 変更 | `structure_matching` で `purpose` ラッピング削除、`format` / `notes` パススルー化（フォールバック付き） |
